# ETHUSD 核心简化策略

## 📋 策略概述

本策略是在完成全品种 OOS 测试后，针对 **ETHUSD** 品种设计的简化版本。通过固定最优权重组合，减少参数空间，专注于提升策略稳健性和样本外表现。

---

## 🎯 核心假设

### 1. 固定权重组合

基于前期 OOS 测试结果，我们发现：
- **核心权重组合**: `w_manip = 0.6, w_ofi = -0.3`
- 在 ETHUSD 测试集上表现最佳（Sharpe 0.370）
- 相比其他权重组合更稳健

**联合信号公式**:
```
joint_score = 0.6 × ManipScore_z - 0.3 × OFI_z
```

### 2. 品种专注

- **唯一品种**: ETHUSD
- **时间周期**: 4H
- **原因**: 
  - ETHUSD 是唯一在 OOS 测试中保持正收益的品种
  - 其他品种（XAUUSD, XAGUSD, EURUSD）在测试集上全部失败

### 3. 简化参数空间

**只调节两个维度**:

1. **z_threshold** (信号阈值)
   - 只在 `|joint_score| >= z_threshold` 时入场
   - 搜索范围: [1.5, 2.0, 2.25, 2.5, 2.75, 3.0]
   - 目的: 平衡信号质量和交易频率

2. **hold_bars** (持仓周期)
   - 持仓 K 线数量
   - 搜索范围: [1, 2, 3, 5, 8]
   - 目的: 找到最优持仓时长

**参数组合总数**: 6 × 5 = **30 个配置**
- 相比之前的 1,224 个配置，大幅减少
- 降低过拟合风险

---

## 🔍 策略逻辑

### 信号生成

1. **计算联合分数**:
   ```python
   joint_score = 0.6 * ManipScore_z - 0.3 * OFI_z
   ```

2. **入场条件**:
   ```python
   if abs(joint_score) >= z_threshold:
       # 根据 ManipScore_z 的方向决定交易方向
       if ManipScore_z > 0:
           signal = -1  # 看空（反转逻辑）
       elif ManipScore_z < 0:
           signal = +1  # 看多（反转逻辑）
   ```

3. **持仓管理**:
   - 持仓 `hold_bars` 个 K 线后平仓
   - 不使用止损/止盈（简化版本）

### 方向逻辑

**ManipScore 反转策略**:
- ManipScore 高 → 市场可能被操纵推高 → **看空**
- ManipScore 低 → 市场可能被操纵压低 → **看多**

**OFI 辅助过滤**:
- OFI 作为负权重 (-0.3)，用于过滤和调整信号强度
- 不单独作为方向判断

---

## 🎯 策略目标

### 1. 提高交易样本数

**问题**: 之前 OOS 测试中部分品种交易次数过少
- XAGUSD: 平均 1 笔交易
- EURUSD: 平均 2.3 笔交易

**解决方案**:
- 降低 z_threshold 下限（从 2.0 到 1.5）
- 设置最小交易次数过滤:
  - 训练集: ≥ 50 笔
  - 测试集: ≥ 20 笔

### 2. 验证策略 Edge

通过更合理的 OOS 和稳健性分析，回答：
- 这个权重组合是否真的有 edge？
- 在不同 z_threshold 下表现如何？
- 参数高原区是否稳定？

### 3. 减少过拟合

**措施**:
- 参数空间从 1,224 减少到 30
- 使用参数高原区（plateau）而非单点最优
- 严格的训练集/测试集分离

---

## 📊 OOS 时间切分

### ETHUSD 数据范围
- **实际数据**: 2017-12-11 to 2025-10-08
- **总时长**: 约 8 年

### 训练集/测试集划分

| 阶段 | 起始日期 | 结束日期 | 时长 | 用途 |
|------|----------|----------|------|------|
| **训练集** | 2017-12-11 | 2020-12-31 | 3 年 | 参数优化 |
| **测试集** | 2021-01-01 | 2025-10-08 | 5 年 | 样本外验证 |

**划分原则**:
- 训练集: 早期数据，用于参数搜索
- 测试集: 近期数据，验证策略稳健性
- 时间边界: 2021 年（COVID 后市场环境变化）

---

## 🔧 参数选择策略

### 高原区（Plateau）方法

**定义**:
```python
plateau_sharpe_frac = 0.7  # 高原阈值

# 在训练集中
S_max_train = max(sharpe_train)
plateau_threshold = plateau_sharpe_frac * S_max_train

# 高原区参数
candidate_params = params where sharpe_train >= plateau_threshold
```

**优势**:
- 避免单点最优的过拟合
- 选择一组稳健参数
- 提高样本外泛化能力

### 最小交易次数过滤

**训练集**:
```python
min_trades_train = 50
```
- 过滤掉交易次数 < 50 的配置
- 确保统计显著性

**测试集**:
```python
min_trades_test = 20
```
- 过滤掉交易次数 < 20 的配置
- 避免小样本偏差

---

## 📈 预期改进

### 相比全参数网格搜索

| 指标 | 之前 | 现在 | 改进 |
|------|------|------|------|
| 参数组合数 | 1,224 | 30 | ↓ 97.5% |
| 过拟合风险 | 高 | 低 | ✅ |
| 训练集 Sharpe | 2.644 | ? | 待测试 |
| 测试集 Sharpe | 0.064 | ? | 期望提升 |
| 平均交易数 | 23 | ? | 期望增加 |

### 关键改进点

1. **参数空间缩小**: 减少过拟合
2. **固定核心权重**: 基于已验证的最优组合
3. **最小交易数过滤**: 提高统计可靠性
4. **高原区选择**: 提升稳健性

---

## 🚀 实施步骤

### 1. 配置准备
```bash
# 配置文件
config/eth_core_params.yaml
```

### 2. 运行回测
```bash
# ETH 核心策略网格 + OOS 回测
python scripts/run_eth_core_grid_oos.py
```

### 3. 结果分析
```bash
# 汇总 OOS 结果
python scripts/summarize_eth_core_oos.py
```

### 4. 输出文件
- `results/oos/eth_core_train_grid.csv` - 训练集网格结果
- `results/oos/eth_core_test_grid.csv` - 测试集验证结果
- `results/oos/eth_core_combo_track.csv` - 核心组合跟踪
- `results/oos/eth_core_oos_summary.csv` - OOS 汇总

---

## 📊 成功标准

### 最低要求

- ✅ 测试集平均 Sharpe > 0.2
- ✅ 测试集正 Sharpe 比例 > 60%
- ✅ 测试集平均交易数 > 30
- ✅ 测试集最大回撤 < 30%

### 理想目标

- 🎯 测试集平均 Sharpe > 0.5
- 🎯 测试集正 Sharpe 比例 > 80%
- 🎯 测试集平均交易数 > 50
- 🎯 测试集最大回撤 < 20%
- 🎯 高原区参数数量 > 5

---

## 🔄 后续优化方向

如果 ETH 核心策略验证成功：

1. **多周期测试**: 1H / 8H / 1D
2. **风险管理**: 添加止损/止盈
3. **动态仓位**: 根据信号强度调整
4. **实盘模拟**: 纸面交易验证
5. **其他品种**: 尝试应用到其他加密货币

---

**版本**: v1.2  
**创建日期**: 2025-11-19  
**状态**: 待测试

