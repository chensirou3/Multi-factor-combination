# é¡¹ç›®è¿›åº¦æŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: ManipScore-OFI è”åˆå› å­åˆ†ææ¡†æ¶  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-19  
**å½“å‰ç‰ˆæœ¬**: v1.0 - ç²¾ç»†ç½‘æ ¼å›æµ‹å®Œæˆ

æœ¬é¡¹ç›®æ•´åˆäº†ä¸¤ä¸ªç‹¬ç«‹çš„å¸‚åœºå¾®è§‚ç»“æ„å› å­ï¼š
- **ManipScore**: å¸‚åœºæ“çºµæ£€æµ‹å› å­ï¼ˆåè½¬é€»è¾‘ï¼‰
- **OFI (Order Flow Imbalance)**: è®¢å•æµå¤±è¡¡å› å­ï¼ˆåŠ¨é‡/è¿‡æ»¤é€»è¾‘ï¼‰

---

## å·²å®Œæˆå·¥ä½œ

### 1. é¡¹ç›®æ¶æ„æ­å»º âœ…

**é…ç½®æ–‡ä»¶** (4ä¸ª):
- `config/paths.yaml` - æ•°æ®è·¯å¾„é…ç½®
- `config/symbols.yaml` - äº¤æ˜“å“ç§é…ç½®
- `config/joint_params.yaml` - ç²—ç½‘æ ¼å‚æ•°é…ç½®
- `config/joint_params_fine.yaml` - ç²¾ç»†ç½‘æ ¼å‚æ•°é…ç½®

**æ ¸å¿ƒæ¨¡å—** (15+):
- `src/utils/` - å·¥å…·æ¨¡å—ï¼ˆé…ç½®åŠ è½½ã€æ—¥å¿—ã€æ–‡ä»¶IOï¼‰
- `src/joint_data/` - æ•°æ®åŠ è½½å’Œåˆå¹¶
- `src/joint_factors/` - å› å­è®¡ç®—å’Œä¿¡å·ç”Ÿæˆ
- `src/analysis/` - æ€§èƒ½åˆ†æ
- `src/backtest/` - å›æµ‹å¼•æ“

**å¯æ‰§è¡Œè„šæœ¬** (7ä¸ª):
- `scripts/generate_manipscore_4h.py` - ä» OHLCV ç”Ÿæˆ ManipScore
- `scripts/build_merged_data.py` - åˆå¹¶ ManipScore å’Œ OFI æ•°æ®
- `scripts/run_joint_filter_grid.py` - Filter æ¨¡å¼ç½‘æ ¼æœç´¢
- `scripts/run_joint_score_grid.py` - Score æ¨¡å¼ç½‘æ ¼æœç´¢
- `scripts/run_all_symbols_fine_grid.py` - æ‰¹é‡è¿è¡Œæ‰€æœ‰å“ç§
- `scripts/analyze_fine_grid_results.py` - ç»“æœåˆ†æ
- `scripts/count_configs.py` - å‚æ•°é…ç½®ç»Ÿè®¡

### 2. æ•°æ®å‡†å¤‡ âœ…

**ManipScore æ•°æ®ç”Ÿæˆ**:
- ä» OFI é¡¹ç›®çš„ OHLCV æ•°æ®è®¡ç®— ManipScore
- 3 ä¸ªç»„ä»¶ï¼šèœ¡çƒ›å›¾å¼‚å¸¸ (40%) + æ´—ç›˜äº¤æ˜“ (40%) + ä»·æ ¼åè½¬ (20%)
- æˆåŠŸç”Ÿæˆ 5 ä¸ªå“ç§çš„ 4H æ•°æ®

**æ•°æ®åˆå¹¶**:
- æˆåŠŸåˆå¹¶ ManipScore å’Œ OFI å› å­æ•°æ®
- æ•°æ®è´¨é‡éªŒè¯é€šè¿‡ï¼ˆç¼ºå¤±ç‡ < 7%ï¼‰
- ä¿å­˜ä¸º Parquet æ ¼å¼

**å“ç§è¦†ç›–**:
| å“ç§ | æ•°æ®é‡ | æ—¶é—´èŒƒå›´ | çŠ¶æ€ |
|------|--------|---------|------|
| BTCUSD | 6,027 bars | 2017-2020 | âœ… |
| ETHUSD | 15,470 bars | 2017-2025 | âœ… |
| XAUUSD | 25,231 bars | 2010-2025 | âœ… |
| XAGUSD | 24,796 bars | 2010-2025 | âœ… |
| EURUSD | 24,779 bars | 2010-2025 | âœ… |

### 3. å›æµ‹å®Œæˆ âœ…

#### ç²—ç½‘æ ¼å›æµ‹ï¼ˆåˆæ­¥æµ‹è¯•ï¼‰
- **å“ç§**: XAUUSD
- **Filter æ¨¡å¼**: 64 ä¸ªé…ç½®
- **Score æ¨¡å¼**: 84 ä¸ªé…ç½®
- **å…³é”®å‘ç°**: Score æ¨¡å¼å‘ç°æ­£æ”¶ç›Šç­–ç•¥ï¼ˆ+1.97%ï¼‰

#### ç²¾ç»†ç½‘æ ¼å›æµ‹ï¼ˆå…¨é¢åˆ†æï¼‰
- **å“ç§**: 5 ä¸ªï¼ˆBTCUSD, ETHUSD, XAUUSD, XAGUSD, EURUSDï¼‰
- **æ€»é…ç½®æ•°**: 9,320 ä¸ª
  - Filter æ¨¡å¼: 640 ä¸ª/å“ç§ Ã— 5 = 3,200 ä¸ª
  - Score æ¨¡å¼: 1,224 ä¸ª/å“ç§ Ã— 5 = 6,120 ä¸ª
- **æ€»è€—æ—¶**: 47.1 åˆ†é’Ÿ
- **å®Œæˆæ—¶é—´**: 2025-11-19 14:25:26

---

## æ ¸å¿ƒå‘ç°

### 1. ç­–ç•¥æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | å¹³å‡ Sharpe | å¹³å‡æ”¶ç›Š | æ­£æ”¶ç›Šå“ç§ | ç‰¹ç‚¹ |
|------|------------|---------|-----------|------|
| **Score æ¨¡å¼** | **0.484** | **3.20%** | **5/5** | é«˜ Sharpeï¼Œä½æ³¢åŠ¨ |
| Filter æ¨¡å¼ | 0.202 | 6.36% | 5/5 | é«˜æ”¶ç›Šï¼Œé«˜æ³¢åŠ¨ |

**ç»“è®º**: Score æ¨¡å¼é£é™©è°ƒæ•´åæ”¶ç›Šæ›´ä¼˜ï¼ˆSharpe é«˜ 2.4 å€ï¼‰

### 2. æœ€ä½³å“ç§æ’å

**Score æ¨¡å¼ Sharpe æ’å**:
1. ğŸ¥‡ **ETHUSD**: 0.730 (æ”¶ç›Š 9.67%, èƒœç‡ 75%)
2. ğŸ¥ˆ **XAGUSD**: 0.566 (æ”¶ç›Š 3.23%, èƒœç‡ 66.7%)
3. ğŸ¥‰ **EURUSD**: 0.504 (æ”¶ç›Š 1.41%, èƒœç‡ 75%)
4. BTCUSD: 0.464 (æ”¶ç›Š 0.63%, èƒœç‡ 33.3%)
5. XAUUSD: 0.154 (æ”¶ç›Š 1.04%, èƒœç‡ 66.7%)

### 3. æœ€ä½³ç­–ç•¥é…ç½®

#### ğŸ† æ¨èç­–ç•¥ï¼šETHUSD Score æ¨¡å¼

```yaml
å“ç§: ETHUSD
æ¨¡å¼: Score (åŠ æƒç»„åˆ)
å‚æ•°:
  weight_manip: 0.6      # ManipScore æƒé‡
  weight_ofi: -0.3       # OFI æƒé‡ï¼ˆåå‘å¯¹å†²ï¼‰
  composite_z_entry: 3.0 # å…¥åœºé˜ˆå€¼
  holding_bars: 5        # æŒä»“ 5 ä¸ª 4H bar (20å°æ—¶)

å›æµ‹è¡¨ç°:
  Sharpe Ratio: 0.730
  Total Return: 9.67%
  Win Rate: 75.0%
  Total Trades: 4
  Max Drawdown: -0.65%
```

### 4. å…³é”®æ¨¡å¼å‘ç°

#### å¯¹å†²ç­–ç•¥ (w_manip=0.6, w_ofi=-0.3)
- åœ¨ **4/5 å“ç§**ä¸­è¡¨ç°æœ€ä½³
- **é€†å‘å¯¹å†²é€»è¾‘**: ManipScore åè½¬ä¿¡å· + OFI åå‘å¯¹å†²
- å½“æ£€æµ‹åˆ°æ“çºµæ—¶ï¼ŒOFI åå‘æŒä»“å¢å¼ºä¿¡å·å¼ºåº¦

#### é«˜é˜ˆå€¼ä½é¢‘äº¤æ˜“
- Z-score é˜ˆå€¼: 2.5-3.5ï¼ˆæç«¯ä¿¡å·ï¼‰
- äº¤æ˜“é¢‘ç‡: 3-34 ç¬”ï¼ˆä½é¢‘é«˜è´¨é‡ï¼‰
- èƒœç‡: 50-75%ï¼ˆé«˜èƒœç‡ï¼‰
- æœ€å¤§å›æ’¤: < 2%ï¼ˆä½é£é™©ï¼‰

#### å“ç§ç‰¹å¼‚æ€§
- **åŠ å¯†è´§å¸**: çŸ­æŒä»“ï¼ˆ1-5 barsï¼‰ï¼Œå¯¹å†²ç­–ç•¥
- **è´µé‡‘å±**: ä¸­ç­‰æŒä»“ï¼ˆ2-10 barsï¼‰ï¼Œæ··åˆç­–ç•¥
- **å¤–æ±‡**: é•¿æŒä»“ï¼ˆ8 barsï¼‰ï¼Œå¯¹å†²ç­–ç•¥

---

## è¾“å‡ºæ–‡ä»¶

### å›æµ‹ç»“æœæ–‡ä»¶
```
results/backtests/
â”œâ”€â”€ filter_grid_BTCUSD_4H_fine.csv    (640 rows)
â”œâ”€â”€ filter_grid_ETHUSD_4H_fine.csv    (640 rows)
â”œâ”€â”€ filter_grid_XAUUSD_4H_fine.csv    (640 rows)
â”œâ”€â”€ filter_grid_XAGUSD_4H_fine.csv    (640 rows)
â”œâ”€â”€ filter_grid_EURUSD_4H_fine.csv    (640 rows)
â”œâ”€â”€ score_grid_BTCUSD_4H_fine.csv     (1,224 rows)
â”œâ”€â”€ score_grid_ETHUSD_4H_fine.csv     (1,224 rows)
â”œâ”€â”€ score_grid_XAUUSD_4H_fine.csv     (1,224 rows)
â”œâ”€â”€ score_grid_XAGUSD_4H_fine.csv     (1,224 rows)
â”œâ”€â”€ score_grid_EURUSD_4H_fine.csv     (1,224 rows)
â”œâ”€â”€ filter_best_per_symbol.csv        (æœ€ä½³ Filter ç­–ç•¥æ±‡æ€»)
â””â”€â”€ score_best_per_symbol.csv         (æœ€ä½³ Score ç­–ç•¥æ±‡æ€»)
```

### æ•°æ®æ–‡ä»¶
```
data/intermediate/merged_4h/
â”œâ”€â”€ BTCUSD_4H_merged.parquet
â”œâ”€â”€ ETHUSD_4H_merged.parquet
â”œâ”€â”€ XAUUSD_4H_merged.parquet
â”œâ”€â”€ XAGUSD_4H_merged.parquet
â””â”€â”€ EURUSD_4H_merged.parquet
```

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸä»»åŠ¡
- [ ] æ ·æœ¬å¤–æµ‹è¯•ï¼ˆè®­ç»ƒé›† vs æµ‹è¯•é›†ï¼‰
- [ ] æ·»åŠ å¯è§†åŒ–åˆ†æï¼ˆæƒç›Šæ›²çº¿ã€å‚æ•°çƒ­åŠ›å›¾ï¼‰
- [ ] å®ç›˜æ¨¡æ‹Ÿæµ‹è¯•

### ä¸­æœŸä»»åŠ¡
- [ ] ç­–ç•¥ä¼˜åŒ–ï¼ˆåŠ¨æ€æ­¢æŸ/æ­¢ç›ˆï¼‰
- [ ] ä»“ä½ç®¡ç†ï¼ˆKelly Criterionï¼‰
- [ ] å¸‚åœºçŠ¶æ€è¿‡æ»¤

### é•¿æœŸä»»åŠ¡
- [ ] å¤šå‘¨æœŸåˆ†æï¼ˆ1H, 8H, 1Dï¼‰
- [ ] æ›´å¤šå“ç§æ‰©å±•
- [ ] å®ç›˜éƒ¨ç½²

---

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.10+
- **æ•°æ®å¤„ç†**: pandas, numpy
- **é…ç½®ç®¡ç†**: PyYAML
- **æ•°æ®å­˜å‚¨**: Parquet (pyarrow)
- **æ—¥å¿—**: logging
- **éƒ¨ç½²**: Ubuntu Server (SSH)

---

## é¡¹ç›®ç»Ÿè®¡

- **ä»£ç æ–‡ä»¶**: 20+ Python æ¨¡å—
- **é…ç½®æ–‡ä»¶**: 4 ä¸ª YAML
- **è„šæœ¬æ–‡ä»¶**: 7 ä¸ªå¯æ‰§è¡Œè„šæœ¬
- **å›æµ‹é…ç½®**: 9,320 ä¸ª
- **æ•°æ®ç‚¹**: 96,303 ä¸ª 4H bars
- **æ€»è€—æ—¶**: 47.1 åˆ†é’Ÿ

---

**æœ€åæ›´æ–°**: 2025-11-19  
**çŠ¶æ€**: âœ… ç²¾ç»†ç½‘æ ¼å›æµ‹å®Œæˆï¼Œå‡†å¤‡ä¸‹ä¸€é˜¶æ®µæµ‹è¯•

